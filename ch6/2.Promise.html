<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.Promise</title>
    <!--
        날짜: 2025/09/01
        이름: 윤종인
        내용: 6장 비동기 
    -->
</head>
<body>
    <h3>2.Promise</h3>
    <script>
        //Promise 생성
        const promise = new Promise((resolve, reject) => {

            //비동기 처리 작업
            const result = true;

            if(result) {
                //작업성공
                resolve('promise success...');
            } else {
                //작업실패
                reject('promise fail...');
            }
        });

        //promise 실행
        promise.then((message) => {
            //작업성공(resolve 호출)
            console.log(message);
        }).catch((message) => {
            //작업실패(reject 호출)
            console.log(message);
        }).finally(() => {
            //마지막 실행
            console.log('finally...');
        });

        //Promise 비동기 처리
        function step1() {
            return new Promise((resolve, reject) => {
                setTimeout(function() {
                    resolve('step1...');
                }, 1000);
            });
        }

        function step2(msg) {
            console.log('step2 msg: ' + msg);

            return new Promise((resolve, reject) => {
                setTimeout(function() {
                    resolve('step2...');
                }, 3000);
            });
        }

        function step3(msg) {
            console.log('step3 msg: ' + msg);

            return new Promise((resolve, reject) => {
                setTimeout(function() {
                    resolve('step3...');
                }, 2000);
            });
        }

        step1()
            .then((msg) => { // step1의 반환 promise의 resolve 호출
                return step2(msg);
        })
        .then((msg) => step3(msg)) // step2의 반환 promise의 resolve 호출
        .then((msg) => { // step3의 반환 promise의 resolve 호출
            console.log('done...');
        })
        .catch((msg) => {
            console.log('catch...');
        })
        .finally(() => {
            console.log('finally...');
        });

        //async, await 이용한 비동기 처리
        async function process() {
            //await를 쓰는 함수 호출을 위해 async 선언
            const msg1 = await step1(); //await는 비동기 처리 작업 완료 대기
            const msg2 = await step2(msg1);
            const msg3 = await step3(msg2);

            console.log(msg3);
        }

        process();

        //비동기 처리 커피 주문하기 예제
        document.addEventListener('DOMContentLoaded', function() {
            const inputCoffee = document.getElementsByName('coffee')[0];
            const btnOrder = document.getElementById('btnOrder');
            const message = document.getElementById('message');

            btnOrder.addEventListener('click',function(e) {
                const coffee = inputCoffee.value;
                message.innerText = `${coffee} 제조 시작...\n`;

                // makeCoffee(coffee); //promise 방식
                makeCoffeeByAwait(coffee); //async 방식
            });

            function makeCoffee(coffee) {
                boilWater(coffee)
                    .then(coffee => brewCoffee(coffee))
                    .then(coffee => pourCoffee(coffee))
                    .then(coffee => doneCoffee(coffee));
            }

            async function makeCoffeeByAwait(coffee) {
                const result1 = await boilWater(coffee);
                const result2 = await brewCoffee(coffee);
                const result3 = await pourCoffee(coffee);
                const result4 = await doneCoffee(coffee);
            }

            function boilWater(coffee) {
                message.innerText += `${coffee}를 위해 물을 끓입니다.\n`;

                return new Promise((resolve,reject) => {
                    setTimeout(function() {
                        resolve(coffee);
                    }, 2000);
                });
            }

            function brewCoffee(coffee) {
                message.innerText += `${coffee}를 내립니다.\n`;

                return new Promise((resolve,reject) => {
                    setTimeout(function() {
                        resolve(coffee);
                    }, 3000);
                });
            }

            function pourCoffee(coffee) {
                message.innerText += `${coffee}를 따릅니다.\n`;

                return new Promise((resolve,reject) => {
                    setTimeout(function() {
                        resolve(coffee);
                    }, 1000);
                });
            }

            function doneCoffee(coffee) {
                message.innerText += `${coffee}가 완성 되었습니다.`;
            }
        });
        
    </script>

    <input type="text" name="coffee">
    <input type="button" id="btnOrder" value="주문하기">

    <h4 id="message">준비중...</h4>
</body>
</html>